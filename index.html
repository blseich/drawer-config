<!DOCTYPE html>
<html ng-app="JSConfigApp">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">

	</head>
	<style>
		.drawer-item {
			margin-bottom: 22px;
		}
		.hidden {
			display:none;
		}
		.btn-file {
			position: relative;
			overflow: hidden;
		}
		.btn-file input[type=file] {
			position: absolute;
			top: 0;
			right: 0;
			min-width: 100%;
			min-height: 100%;
			font-size: 100px;
			text-align: right;
			filter: alpha(opacity=0);
			opacity: 0;
			outline: none;
			background: white;
			cursor: inherit;
			display: block;
		}
		.full-spectrum .sp-palette {
      max-width: 200px;
    }
    .btn-blue {
    	border-color: #000;
      border: 1px solid rgba(0, 0, 0, 0.13);
    }

    .btn-toolbar>.btn-group {
      margin-bottom:12px;
    }

    [ta-button] {
      height: 44px;
      margin-bottom: 5px;
    }

	</style>
	<body ng-controller="JSConfigAppCtrl">
		<div class="container">
			<div class="row">
				<div class="col-sm-8">
					<h1>Promo Drawer Configuration Tool</h1>
				</div>
				<div class="col-sm-4">
				</div>
			</div>
			<form name="cellForm" ng-submit="submitForm(cellForm.$valid)" novalidate>
			<div class="row">
				<div class="col-sm-12">
					<div class="form-group" ng-class="{ 'has-error' : cellForm.headerText.$invalid && !cellForm.headerText.$pristine }">
						<label for="headerText">Drawer Header Text</label>
						<input type="text" name="headerText" class="form-control" ng-model="promos.global.headerText" id="headerText" placeholder="Enter Header Text" required ng-minlength="1" ng-maxlength="24">
						<p ng-show="cellForm.headerText.$error.minlength" class="help-block">Minimum of 1 character.</p>
						<p ng-show="cellForm.headerText.$error.maxlength" class="help-block">24 characters maximum.</p>
					</div>
					<div class="form-group">
						<label for="headerSubText">Drawer Header Sub Text</label>
						<input type="text" class="form-control" ng-model="promos.global.subHeaderText" id="headerSubText" placeholder="Enter Header Sub Text" >
					</div>
				</div>
			</div>
			<div class="row" ng-repeat="promo in promos.global.promos track by $index">
				<div class="col-sm-12">
					<div class="panel panel-info">
						<div class="panel-heading">
							<h2 class="panel-title">Drawer Cell {{$index + 1}}
							  <button
							    ng-show="promos.global.promos.length > 1"
							    style="margin-left:12px;line-height:18px;"
							    ng-click="moveCell($index,1)"
							    class="btn btn-info btn-xs fa fa-arrow-circle-down">
							  </button>
							  <button
							    ng-show="promos.global.promos.length > 1"
							    style="margin-left:12px;line-height:18px;"
							    ng-click="moveCell($index,-1)"
							    class="btn btn-info btn-xs fa fa-arrow-circle-up">
							  </button>
                <button
                  ng-show="promos.global.promos.length > 1"
                  class="btn pull-right btn-info btn-xs fa fa-times"
                  ng-click="delete($index)">
							  </button>
							</h2>
						</div>
						<div class="panel-body">
							<div class="col-sm-7">
								<div class="panel panel-default">
									<div class="panel-heading">Banner Content</div>

									<div class="panel-body">
										<div class="col-sm-12">
											<div class="form-group">
												<div class="radio">
												  <label class="radio-inline">
													<input type="radio" ng-model="promo.bannerContent.imgOrHTML" value="img" name="group_{{$index}}">
													<strong>Image</strong> - Cell loads an image with options for a single link, image mapping or no link.
												  </label>
												</div>
												<div class="radio">
												  <label class="radio-inline">
													<input type="radio" ng-model="promo.bannerContent.imgOrHTML" value="html" name="group_{{$index}}">
													<strong>HTML</strong> - cell loads HTML content or iframe to display advanced messaging
												  </label>
												</div>
											</div>
											<div class="img-container" ng-show="promo.bannerContent.imgOrHTML == 'img'">
												<div class="form-group">
													<span class="btn btn-success btn-file" ng-hide="promo.bannerContent.img.images.dataUri">
														Import jpg (331w x 183h, 48kb max) <input id="the-img-input" ng-click="setPageNumber($index)" type="file" >
													</span>
													<button class="btn btn-danger" ng-click="erasePic($index)" ng-show="promo.bannerContent.img.images.dataUri">Delete image</button>
												</div>
												<div class="form-group" ng-show="promo.bannerContent.img.images.dataUri">
													<img data-ng-src="{{promo.bannerContent.img.images.dataUri}}" class="img-responsive">
													<div style="margin-top:15px;" class="alert alert-warning" ng-show="imgError">
													  <h4>Warning!</h4>
													  <p>{{imgError}}</p>
													</div>
												</div>
												<div class="form-group" ng-hide="promo.bannerContent.img.images.dataUri">
													<label for="inputImageUrl">Cell image path</label>
													<input type="text" ng-model="promo.bannerContent.img.images.path" class="form-control" id="inputImageUrl" placeholder="URL">
												</div>
												<div class="form-group" ng-show="promo.bannerContent.img.images.dataUri">
													<div class="checkbox">
														<label>
															<input type="checkbox" ng-model="promo.bannerContent.img.contentParameters.link"> Link image</input>
														</label>
													</div>
													<div class="checkbox">
														<label>
															<input type="checkbox" ng-model="promo.bannerContent.img.contentParameters.useMap"> Map image</input>
														</label>
													</div>
													<textarea ng-show="promo.bannerContent.img.contentParameters.useMap" class="form-control" rows="3" id="textArea" ng-model="promo.bannerContent.img.contentParameters.imageMap" placeholder="paste image map data here"></textarea>
													<br>
													<button id="mapButton" dataUri="{{promo.bannerContent.img.images.dataUri}}" ng-show="promo.bannerContent.img.contentParameters.useMap" type="button" class="btn btn-info" data-toggle="modal" data-target="#myModal">Map Image</button>
													<div id="myModal" class="modal fade" role="dialog">
													  <div class="modal-dialog modal-lg">

													    <!-- Modal content-->
													    <div class="modal-content">
													      <div class="modal-header">
													        <button type="button" class="close" data-dismiss="modal">&times;</button>
													        <h4 class="modal-title">Image Mapping Tool</h4>
													      </div>
													      <div class="modal-body">
																	<div id="wrapper">
																		<header id="header">
																			<nav id="nav" class="clearfix">
																				<ul>
																					<li id="save"><a href="#">save</a></li>
																					<li id="load"><a href="#">load</a></li>
																					<li id="from_html"><a href="#">from html</a></li>
																					<li id="rect"><a href="#">rectangle</a></li>
																					<li id="circle"><a href="#">circle</a></li>
																					<li id="polygon"><a href="#">polygon</a></li>
																					<li id="edit"><a href="#">edit</a></li>
																					<li id="to_html"><a href="#">to html</a></li>
																					<li id="preview"><a href="#">preview</a></li>
																					<li id="clear"><a href="#">clear</a></li>
																					<li id="new_image"><a href="#">new image</a></li>
																					<li id="show_help"><a href="#">?</a></li>
																				</ul>
																			</nav>
																			<div id="coords"></div>
																			<div id="debug"></div>
																		</header>
																		<div id="image_wrapper">
																			<div id="image">
																				<img src="" alt="#" id="img" />
																				<svg xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny" id="svg"></svg>
																			</div>
																		</div>
																	</div>

																	<!-- For html image map code -->
																	<div id="code">
																		<span class="close_button" title="close"></span>
																		<div id="code_content"></div>
																	</div>

																	<!-- Edit details block -->
																	<div id="edit_details">
																		<h5 id="h5">Attrubutes</h5>
																		<span id="close_button" class="close_button" title="close"></span>
																		<p>
																			<label for="href_attr">href</label>
																			<input type="text" id="href_attr" />
																		</p>
																		<p>
																			<label for="alt_attr">alt</label>
																			<input type="text" id="alt_attr" />
																		</p>
																		<p>
																			<label for="title_attr">title</label>
																			<input type="text" id="title_attr" />
																		</p>
																		<button id="save_details">Save</button>
																	</div>

																	<!-- From html block -->
																	<div id="from_html_wrapper">
																		<form id="from_html_form">
																			<h5>Loading areas</h5>
																			<span class="close_button" title="close"></span>
																			<p>
																				<label for="code_input">Enter your html code:</label>
																				<textarea id="code_input"></textarea>
																			</p>
																			<button id="load_code_button">Load</button>
																		</form>
																	</div>

																	<!-- Get image form -->
																	<div id="get_image_wrapper">
																		<div id="get_image">
																			<div id="loading">Loading</div>
																			<div id="file_reader_support">
																				<div id="dropzone">
																					<span class="clear_button" title="clear">x</span>
																					<img src alt="preview" id="sm_img" />
																				</div>
																			</div>
																			<label for="url">type a url</label>
																			<span id="url_wrapper">
																				<span class="clear_button" title="clear">x</span>
																				<input type="text" id="url" />
																			</span>
																			<button id="button" dataUri="promo.bannerContent.img.images.dataUri">OK</button>
																		</div>
																	</div>

																	<!-- Help block -->
																	<div id="overlay"></div>
																	<div id="help">
																		<span class="close_button" title="close"></span>
																		<div class="txt">
																			<section>
																				<h2>Main</h2>
																				<p><span class="key">F5</span> &mdash; reload the page and display the form for loading image again</p>
																				<p><span class="key">S</span> &mdash; save map params in localStorage</p>
																			</section>
																			<section>
																				<h2>Drawing mode (rectangle / circle / polygon)</h2>
																				<p><span class="key">ENTER</span> &mdash; stop polygon drawing (or click on first helper)</p>
																				<p><span class="key">ESC</span> &mdash; cancel drawing of a new area</p>
																				<p><span class="key">SHIFT</span> &mdash; square drawing in case of a rectangle and right angle drawing in case of a polygon</p>
																			</section>
																			<section>
																			<h2>Editing mode</h2>
																				<p><span class="key">DELETE</span> &mdash; remove a selected area</p>
																				<p><span class="key">ESC</span> &mdash; cancel editing of a selected area</p>
																				<p><span class="key">SHIFT</span> &mdash; edit and save proportions for rectangle</p>
																				<p><span class="key">I</span> &mdash; edit attributes of a selected area (or dblclick on an area)</p>
																				<p><span class="key">CTRL</span> + <span class="key">C</span> &mdash; a copy of the selected area</p>
																				<p><span class="key">&uarr;</span> &mdash; move a selected area up</p>
																				<p><span class="key">&darr;</span> &mdash; move a selected area down</p>
																				<p><span class="key">&larr;</span> &mdash; move a selected area to the left</p>
																				<p><span class="key">&rarr;</span> &mdash; move a selected area to the right</p>
																			</section>
																		</div>
																		<footer>
																			<a href="http://github.com/summerstyle/summer">Summer html image map creator 0.5</a><br />
																			&copy; 2014 Vera Lobatcheva<br />
																			GPL3 License
																		</footer>
																	</div>

													      </div>
													      <div class="modal-footer">
													        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
													      </div>
													    </div>

													  </div>
													</div>
												</div>

												<div class="form-group" ng-show="promo.bannerContent.img.contentParameters.link == true">
													<label for="inputUrl">Cell link URL</label>
													<input ng-model="promo.bannerContent.img.contentParameters.linkUrl" type="text" class="form-control" id="inputUrl" placeholder="URL">
												</div>
											</div>

											<div class="HTML-container" ng-show="promo.bannerContent.imgOrHTML == 'html'">
												<div class="form-group">
													<label>
														<input type="checkbox" ng-model="promo.bannerContent.HTML.useLocal"> Generate HTML
													</label>
												</div>
												<div class="form-group" ng-hide="promo.bannerContent.HTML.useLocal">
													<label for="inputImageUrl">HTML path</label>
													<input type="text" ng-model="promo.bannerContent.HTML.path" class="form-control" placeholder="URL">
												</div>
												<div class="form-group" ng-show="promo.bannerContent.HTML.useLocal">
													<label for="html">HTML Content</label>
													<text-angular ng-model="promo.bannerContent.HTML.localHTML"  class="html-banner-br"></text-angular>
												</div>
												<div class="form-group" ng-show="promo.bannerContent.HTML.useLocal">
													<label for="bgcolor">Background Color</label><br>
													<spectrum-colorpicker name="bgcolor" ng-model="promo.bannerContent.HTML.backgroundColor" format="'hex'" class="bg-colorpicker" on-change="bgColorChange($index)" options="{replacerClassName: 'fa fa-eyedropper', showButtons: true, showInput: true, preferredFormat: 'hex'}"></spectrum-colorpicker>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-5">
								<div class="panel panel-default">
									<div class="panel-heading">Banner Footer</div>
									<div class="panel-body">
										<div class="form-group">
											<div class="radio">
											  <label class="radio-inline">
												<input type="radio" ng-model="promo.tapContent.displayType" value="generic" name="tapType_{{$index}}">
												<strong>Generic</strong> - display generic code
											  </label>
											</div>
											<div class="radio">
											  <label class="radio-inline">
												<input type="radio" ng-model="promo.tapContent.displayType" value="tap" name="tapType_{{$index}}" ng-change="attachRedeem()">
												<strong>Tap to apply</strong> - display a "redeem now" button which applies the code
											  </label>
											</div>
											<div class="radio">
											  <label class="radio-inline">
												<input type="radio" ng-model="promo.tapContent.displayType" value="none" name="tapType_{{$index}}">
												<strong>None</strong> - display "No code required"
											  </label>
											</div>
										</div>
										<form class="form">
											<div class="form-group" ng-hide="promo.tapContent.displayType == 'none'" ng-class="{ 'has-error' : cellForm.genericCodeId.$invalid && !cellForm.genericCodeId.$pristine }">
												<label for="genericCodeId">PPC ID</label>
												<input type="text" name="genericCodeId" ng-model="promo.tapContent.genericCodeId" class="form-control" id="genericCodeId" ng-pattern="/^[0-9]*$/" placeholder="123456">
												<p ng-show="cellForm.genericCodeId.$error.pattern" class="help-block">Only numbers are allowed.</p>
											</div>
											<div class="form-group" ng-hide="promo.tapContent.displayType == 'none'">
												<label for="genericCode">Generic code</label>
												<input name="genericCode" type="text" ng-model="promo.tapContent.genericCode" class="form-control" id="genericCode" placeholder="SAVENOW">
											</div>
										</form>
										<div class="form-group" ng-hide="promo.tapContent.displayType == 'none'">
											<label for="inputUrl">Legal popup text override</label>
											<textarea class="form-control" rows="3" id="textArea" ng-model="promo.tapContent.legalOverride" placeholder="If empty, PPC ID will be used to generate legal popup text"></textarea>
										</div>
										<div class="form-group" ng-show="promo.tapContent.genericCode && promo.tapContent.genericCodeId && promo.tapContent.displayType != 'none'">
											<label for="preview">iframe preview</label>
											<!-- <iframe name="preview" frameborder="0" scrolling="yes" ng-src="{{cleanUrl($index)}}"></iframe> -->
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-sm-12">
					<button style="margin-bottom: 22px;" class="btn btn-success pull-right" ng-click="addItem()">Add promo cell</button><br>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-3">
				</div>
				<div class="col-sm-6">
					<div class="panel panel-default" >
						<div class="panel-heading">
							<h2 class="panel-title">Preview : Iphone 4 resolution</h2>
						</div>
						<div class="panel-body" style="width:350px;margin:15px auto; border: 1px solid #ddd;background:black;">
							<span class="label label-danger" ng-hide="promos.global.headerText">No header defined</span>
							<span class="offerspotlight-title-text">{{promos.global.headerText}}</span>
							<br>
							<span class="label label-danger" ng-hide="promos.global.subHeaderText">No subheader defined</span>
							<span class="offerspotlight-title-subtext">{{promos.global.subHeaderText}}</span>
							<div class="offerspotlight-drawer" style="position:relative!important;">
								<div class="offerspotlight-drawer-slider">
									<div class="offerspotlight-drawer-slider-items">
										<div class="offerspotlight-drawer-slider-item" ng-repeat="promo in promos.global.promos track by $index" ng-show="promo.bannerContent.img.images.path || promo.bannerContent.img.images.dataUri || promo.bannerContent.HTML.path || promo.bannerContent.HTML.useLocal">
											<div class="item-banner-content" ng-show="promo.bannerContent.imgOrHTML == 'html' && promo.bannerContent.HTML.useLocal">
												<div style="vertical-align:middle;width:256px;height:142px;border:1px solid #AAA;-moz-box-sizing:border-box;-webkit-box-sizing: border-box;box-sizing:border-box;">
													<div ng-bind-html="promo.bannerContent.HTML.localHTML" class="html-banner-br html-preview" style="height:100%">
													</div>
												</div>
											</div>
											<div class="item-banner-content" ng-show="promo.bannerContent.imgOrHTML == 'html' && !promo.bannerContent.HTML.useLocal">
												<iframe frameborder="0" scrolling="no" style="width:256px;height:142px;" ng-src="{{promo.bannerContent.HTML.path}}"></iframe>
											</div>
											<div class="item-banner-content" ng-show="promo.bannerContent.imgOrHTML == 'img'">
												<a ng-href="{{promo.bannerContent.img.contentParameters.linkUrl}}" ng-show="promo.bannerContent.img.contentParameters.link">
													<img width="256" height="142" class="bannerimg" data-ng-src="{{promo.bannerContent.img.images.dataUri}}" ng-hide="!promo.bannerContent.img.images.dataUri">
													<img width="256" height="142" class="bannerimg" ng-src="{{promo.bannerContent.img.images.path}}" ng-hide="!promo.bannerContent.img.images.path">
												</a>
												<img width="256" height="142" class="bannerimg" data-ng-src="{{promo.bannerContent.img.images.dataUri}}" ng-hide="!promo.bannerContent.img.images.dataUri || promo.bannerContent.img.contentParameters.link">
												<img width="256" height="142" class="bannerimg" ng-src="{{promo.bannerContent.img.images.path}}" ng-hide="!promo.bannerContent.img.images.path || promo.bannerContent.img.contentParameters.link">
											</div>
											<div class="spotlight-footer">
                        <div class="control-code column1" ng-hide="promo.tapContent.displayType == 'none'">
                          <a href="#" class="redeem" ng-show="promo.tapContent.displayType == 'tap'">TAP TO APPLY</a>
                          <span class="gen" ng-show="promo.tapContent.displayType == 'generic'">Enter <span class="strong">{{promo.tapContent.genericCode}}</span><br> at checkout</span>
                          <span class="none" ng-show="promo.tapContent.displayType == 'none'">NO CODE REQUIRED</span>
                        </div>
                        <div class="control-apply column2">
                          <a href="#normal" class="legal-details">
                            <span class="legal">details</span>
                          </a>
                        </div>
                      </div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-sm-3">
				</div>
			</div>
			<div class="row">
				<div class="col-sm-12">
					<div class="panel panel-default">
						<div class="panel-body">
							<div class="col-sm-6">
								<span class="btn btn-default btn-block btn-file">
									Import config.json file <input id="the-file-input" type="file">
								</span>
							</div>
							<div class="col-sm-6">
								<a download="config.json" class="btn btn-primary btn-block" role="button" ng-href="data:text/json;charset=utf-8,{{myEncodeJson(promos)}}">Export config.json file</a>
							</div>
						</div>
					</div>
				</div>
			</div>

      <!--
			<div class="row">
				<div class="col-sm-12">
					<div class="panel panel-default">
					<div class="panel-heading">Output</div>
					<div class="panel-body"><code>{{promos}}</code></div>
				</div>
				</div>
			</div>
      -->

			<div class="row">
				<div class="col-sm-12"></div>
			</div>
		</div>
		</form>
		<link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- inportant: this css should remain linked by brand -->
		<link rel="stylesheet" href="css/spotlight-drawer.css">
		<link rel="stylesheet" type="text/css" href="brand-css-files/br-style.css">

		<link rel="stylesheet" href="css/textAngular.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="css/spectrum.min.css" />
		<link rel="stylesheet" type="text/css" href="css/image-mapper-main.css" />
		<script src="js/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/angular.min.js"></script>
		<script>
		(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports=="object"&&typeof module=="object"){module.exports=a}else{a(jQuery)}}})(function(e,g){var m={beforeShow:b,move:b,change:b,show:b,hide:b,color:false,flat:false,showInput:false,allowEmpty:false,showButtons:true,clickoutFiresChange:true,showInitial:false,showPalette:false,showPaletteOnly:false,hideAfterPaletteSelect:false,togglePaletteOnly:false,showSelectionPalette:true,localStorageKey:false,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:false,className:"",containerClassName:"",replacerClassName:"",showAlpha:false,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:false,offset:null},d=[],h=!!/msie/i.exec(window.navigator.userAgent),l=(function(){function u(y,x){return !!~(""+y).indexOf(x)}var w=document.createElement("div");var v=w.style;v.cssText="background-color:rgba(0,0,0,.5)";return u(v.backgroundColor,"rgba")||u(v.backgroundColor,"hsla")})(),q=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),p=(function(){var u="";if(h){for(var v=1;v<=6;v++){u+="<div class='sp-"+v+"'></div>"}}return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",u,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")})();function s(w,y,C,u){var A=[];for(var z=0;z<w.length;z++){var B=w[z];if(B){var v=tinycolor(B);var E=v.toHsl().l<0.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";E+=(tinycolor.equals(y,B))?" sp-thumb-active":"";var D=v.toString(u.preferredFormat||"rgb");var x=l?("background-color:"+v.toRgbString()):"filter:"+v.toFilter();A.push('<span title="'+D+'" data-color="'+v.toRgbString()+'" class="'+E+'"><span class="sp-thumb-inner" style="'+x+';" /></span>')}else{var F="sp-clear-display";A.push(e("<div />").append(e('<span data-color="" style="background-color:transparent;" class="'+F+'"></span>').attr("title",u.noColorSelectedText)).html())}}return"<div class='sp-cf "+C+"'>"+A.join("")+"</div>"}function o(){for(var u=0;u<d.length;u++){if(d[u]){d[u].hide()}}}function n(w,u){var v=e.extend({},m,w);v.callbacks={move:t(v.move,u),change:t(v.change,u),show:t(v.show,u),hide:t(v.hide,u),beforeShow:t(v.beforeShow,u)};return v}function r(a8,ah){var a7=n(ah,a8),a3=a7.flat,W=a7.showSelectionPalette,w=a7.localStorageKey,ak=a7.theme,R=a7.callbacks,E=f(ad,10),O=false,ap=false,aM=0,af=0,aN=0,az=0,L=0,ay=0,aY=0,ar=0,Y=0,P=0,aC=0,aZ=1,ai=[],al=[],a5={},aI=a7.selectionPalette.slice(0),aH=a7.maxSelectionSize,x="sp-dragging",G=null;var X=a8.ownerDocument,N=X.body,D=e(a8),aW=false,aO=e(p,X).addClass(ak),u=aO.find(".sp-picker-container"),I=aO.find(".sp-color"),aL=aO.find(".sp-dragger"),M=aO.find(".sp-hue"),a2=aO.find(".sp-slider"),aE=aO.find(".sp-alpha-inner"),Z=aO.find(".sp-alpha"),aF=aO.find(".sp-alpha-handle"),K=aO.find(".sp-input"),Q=aO.find(".sp-palette"),a6=aO.find(".sp-initial"),aq=aO.find(".sp-cancel"),an=aO.find(".sp-clear"),H=aO.find(".sp-choose"),aQ=aO.find(".sp-palette-toggle"),S=D.is("input"),B=S&&D.attr("type")==="color"&&k(),aB=S&&!a3,aU=(aB)?e(q).addClass(ak).addClass(a7.className).addClass(a7.replacerClassName):e([]),aw=(aB)?aU:D,J=aU.find(".sp-preview-inner"),T=a7.color||(S&&D.val()),aP=false,V=a7.preferredFormat,au=V,F=!a7.showButtons||a7.clickoutFiresChange,C=!T,a4=a7.allowEmpty&&!B;function v(){if(a7.showPaletteOnly){a7.showPalette=true}aQ.text(a7.showPaletteOnly?a7.togglePaletteMoreText:a7.togglePaletteLessText);if(a7.palette){ai=a7.palette.slice(0);al=e.isArray(ai[0])?ai:[ai];a5={};for(var bc=0;bc<al.length;bc++){for(var bb=0;bb<al[bc].length;bb++){var ba=tinycolor(al[bc][bb]).toRgbString();a5[ba]=true}}}aO.toggleClass("sp-flat",a3);aO.toggleClass("sp-input-disabled",!a7.showInput);aO.toggleClass("sp-alpha-enabled",a7.showAlpha);aO.toggleClass("sp-clear-enabled",a4);aO.toggleClass("sp-buttons-disabled",!a7.showButtons);aO.toggleClass("sp-palette-buttons-disabled",!a7.togglePaletteOnly);aO.toggleClass("sp-palette-disabled",!a7.showPalette);aO.toggleClass("sp-palette-only",a7.showPaletteOnly);aO.toggleClass("sp-initial-disabled",!a7.showInitial);aO.addClass(a7.className).addClass(a7.containerClassName);ad()}function aJ(){if(h){aO.find("*:not(input)").attr("unselectable","on")}v();if(aB){D.after(aU).hide()}if(!a4){an.hide()}if(a3){D.after(aO).hide()}else{var bb=a7.appendTo==="parent"?D.parent():e(a7.appendTo);if(bb.length!==1){bb=e("body")}bb.append(aO)}aR();aw.bind("click.spectrum touchstart.spectrum",function(bd){if(!aW){ax()}bd.stopPropagation();if(!e(bd.target).is("input")){bd.preventDefault()}});if(D.is(":disabled")||(a7.disabled===true)){U()}aO.click(j);K.change(aS);K.bind("paste",function(){setTimeout(aS,1)});K.keydown(function(bd){if(bd.keyCode==13){aS()}});aq.text(a7.cancelText);aq.bind("click.spectrum",function(bd){bd.stopPropagation();bd.preventDefault();av();aG()});an.attr("title",a7.clearText);an.bind("click.spectrum",function(bd){bd.stopPropagation();bd.preventDefault();C=true;aK();if(a3){ao(true)}});H.text(a7.chooseText);H.bind("click.spectrum",function(bd){bd.stopPropagation();bd.preventDefault();if(h&&K.is(":focus")){K.trigger("change")}if(aA()){ao(true);aG()}});aQ.text(a7.showPaletteOnly?a7.togglePaletteMoreText:a7.togglePaletteLessText);aQ.bind("click.spectrum",function(bd){bd.stopPropagation();bd.preventDefault();a7.showPaletteOnly=!a7.showPaletteOnly;if(!a7.showPaletteOnly&&!a3){aO.css("left","-="+(u.outerWidth(true)+5))}v()});c(Z,function(bf,be,bd){aZ=(bf/ay);C=false;if(bd.shiftKey){aZ=Math.round(aZ*10)/10}aK()},A,a9);c(M,function(be,bd){Y=parseFloat(bd/az);C=false;if(!a7.showAlpha){aZ=1}aK()},A,a9);c(I,function(bk,bi,bh){if(!bh.shiftKey){G=null}else{if(!G){var bf=P*aM;var bd=af-(aC*af);var be=Math.abs(bk-bf)>Math.abs(bi-bd);G=be?"x":"y"}}var bg=!G||G==="x";var bj=!G||G==="y";if(bg){P=parseFloat(bk/aM)}if(bj){aC=parseFloat((af-bi)/af)}C=false;if(!a7.showAlpha){aZ=1}aK()},A,a9);if(!!T){ac(T);aD();au=V||tinycolor(T).format;aV(T)}else{aD()}if(a3){z()}function bc(bd){if(bd.data&&bd.data.ignore){ac(e(bd.target).closest(".sp-thumb-el").data("color"));aK()}else{ac(e(bd.target).closest(".sp-thumb-el").data("color"));aK();ao(true);if(a7.hideAfterPaletteSelect){aG()}}return false}var ba=h?"mousedown.spectrum":"click.spectrum touchstart.spectrum";Q.delegate(".sp-thumb-el",ba,bc);a6.delegate(".sp-thumb-el:nth-child(1)",ba,{ignore:true},bc)}function aR(){if(w&&window.localStorage){try{var ba=window.localStorage[w].split(",#");if(ba.length>1){delete window.localStorage[w];e.each(ba,function(bc,bd){aV(bd)})}}catch(bb){}try{aI=window.localStorage[w].split(";")}catch(bb){}}}function aV(ba){if(W){var bb=tinycolor(ba).toRgbString();if(!a5[bb]&&e.inArray(bb,aI)===-1){aI.push(bb);while(aI.length>aH){aI.shift()}}if(w&&window.localStorage){try{window.localStorage[w]=aI.join(";")}catch(bc){}}}}function aX(){var bc=[];if(a7.showPalette){for(var bb=0;bb<aI.length;bb++){var ba=tinycolor(aI[bb]).toRgbString();if(!a5[ba]){bc.push(aI[bb])}}}return bc.reverse().slice(0,a7.maxSelectionSize)}function a0(){var ba=aT();var bb=e.map(al,function(bc,bd){return s(bc,ba,"sp-palette-row sp-palette-row-"+bd,a7)});aR();if(aI){bb.push(s(aX(),ba,"sp-palette-row sp-palette-row-selection",a7))}Q.html(bb.join(""))}function at(){if(a7.showInitial){var ba=aP;var bb=aT();a6.html(s([ba,bb],bb,"sp-palette-row-initial",a7))}}function A(){if(af<=0||aM<=0||az<=0){ad()}ap=true;aO.addClass(x);G=null;D.trigger("dragstart.spectrum",[aT()])}function a9(){ap=false;aO.removeClass(x);D.trigger("dragstop.spectrum",[aT()])}function aS(){var bb=K.val();if((bb===null||bb==="")&&a4){ac(null);ao(true)}else{var ba=tinycolor(bb);if(ba.isValid()){ac(ba);ao(true)}else{K.addClass("sp-validation-error")}}}function ax(){if(O){aG()}else{z()}}function z(){var ba=e.Event("beforeShow.spectrum");if(O){ad();return}D.trigger(ba,[aT()]);if(R.beforeShow(aT())===false||ba.isDefaultPrevented()){return}o();O=true;e(X).bind("keydown.spectrum",aj);e(X).bind("click.spectrum",ab);e(window).bind("resize.spectrum",E);aU.addClass("sp-active");aO.removeClass("sp-hidden");ad();aD();aP=aT();at();R.show(aP);D.trigger("show.spectrum",[aP])}function aj(ba){if(ba.keyCode===27){aG()}}function ab(ba){if(ba.button==2){return}if(ap){return}if(F){ao(true)}else{av()}aG()}function aG(){if(!O||a3){return}O=false;e(X).unbind("keydown.spectrum",aj);e(X).unbind("click.spectrum",ab);e(window).unbind("resize.spectrum",E);aU.removeClass("sp-active");aO.addClass("sp-hidden");R.hide(aT());D.trigger("hide.spectrum",[aT()])}function av(){ac(aP,true)}function ac(ba,bc){if(tinycolor.equals(ba,aT())){aD();return}var bb,bd;if(!ba&&a4){C=true}else{C=false;bb=tinycolor(ba);bd=bb.toHsv();Y=(bd.h%360)/360;P=bd.s;aC=bd.v;aZ=bd.a}aD();if(bb&&bb.isValid()&&!bc){au=V||bb.getFormat()}}function aT(ba){ba=ba||{};if(a4&&C){return null}return tinycolor.fromRatio({h:Y,s:P,v:aC,a:Math.round(aZ*100)/100},{format:ba.format||au})}function aA(){return !K.hasClass("sp-validation-error")}function aK(){aD();R.move(aT());D.trigger("move.spectrum",[aT()])}function aD(){K.removeClass("sp-validation-error");a1();var bc=tinycolor.fromRatio({h:Y,s:1,v:1});I.css("background-color",bc.toHexString());var bh=au;if(aZ<1&&!(aZ===0&&bh==="name")){if(bh==="hex"||bh==="hex3"||bh==="hex6"||bh==="name"){bh="rgb"}}var ba=aT({format:bh}),bd="";J.removeClass("sp-clear-display");J.css("background-color","transparent");if(!ba&&a4){J.addClass("sp-clear-display")}else{var be=ba.toHexString(),bi=ba.toRgbString();if(l||ba.alpha===1){J.css("background-color",bi)}else{J.css("background-color","transparent");J.css("filter",ba.toFilter())}if(a7.showAlpha){var bf=ba.toRgb();bf.a=0;var bb=tinycolor(bf).toRgbString();var bg="linear-gradient(left, "+bb+", "+be+")";if(h){aE.css("filter",tinycolor(bb).toFilter({gradientType:1},be))}else{aE.css("background","-webkit-"+bg);aE.css("background","-moz-"+bg);aE.css("background","-ms-"+bg);aE.css("background","linear-gradient(to right, "+bb+", "+be+")")}}bd=ba.toString(bh)}if(a7.showInput){K.val(bd)}if(a7.showPalette){a0()}at()}function a1(){var bc=P;var ba=aC;if(a4&&C){aF.hide();a2.hide();aL.hide()}else{aF.show();a2.show();aL.show();var bf=bc*aM;var bd=af-(ba*af);bf=Math.max(-aN,Math.min(aM-aN,bf-aN));bd=Math.max(-aN,Math.min(af-aN,bd-aN));aL.css({top:bd+"px",left:bf+"px"});var bb=aZ*ay;aF.css({left:(bb-(aY/2))+"px"});var be=(Y)*az;a2.css({top:(be-ar)+"px"})}}function ao(bb){var ba=aT(),bd="",bc=!tinycolor.equals(ba,aP);if(ba){bd=ba.toString(au);aV(ba)}if(S){D.val(bd)}if(bb&&bc){R.change(ba);D.trigger("change",[ba])}}function ad(){aM=I.width();af=I.height();aN=aL.height();L=M.width();az=M.height();ar=a2.height();ay=Z.width();aY=aF.width();if(!a3){aO.css("position","absolute");if(a7.offset){aO.offset(a7.offset)}else{aO.offset(a(aO,aw))}}a1();if(a7.showPalette){a0()}D.trigger("reflow.spectrum")}function y(){D.show();aw.unbind("click.spectrum touchstart.spectrum");aO.remove();aU.remove();d[ae.id]=null}function aa(ba,bb){if(ba===g){return e.extend({},a7)}if(bb===g){return a7[ba]}a7[ba]=bb;v()}function ag(){aW=false;D.attr("disabled",false);aw.removeClass("sp-disabled")}function U(){aG();aW=true;D.attr("disabled",true);aw.addClass("sp-disabled")}function am(ba){a7.offset=ba;ad()}aJ();var ae={show:z,hide:aG,toggle:ax,reflow:ad,option:aa,enable:ag,disable:U,offset:am,set:function(ba){ac(ba);ao()},get:aT,destroy:y,container:aO};ae.id=d.push(ae)-1;return ae}function a(B,C){var A=0;var y=B.outerWidth();var E=B.outerHeight();var u=C.outerHeight();var D=B[0].ownerDocument;var v=D.documentElement;var z=v.clientWidth+e(D).scrollLeft();var w=v.clientHeight+e(D).scrollTop();var x=C.offset();x.top+=u;x.left-=Math.min(x.left,(x.left+y>z&&z>y)?Math.abs(x.left+y-z):0);x.top-=Math.min(x.top,((x.top+E>w&&w>E)?Math.abs(E+u-A):A));return x}function b(){}function j(u){u.stopPropagation()}function t(v,w){var x=Array.prototype.slice;var u=x.call(arguments,2);return function(){return v.apply(w,u.concat(x.call(arguments)))}}function c(z,E,v,w){E=E||function(){};v=v||function(){};w=w||function(){};var F=document;var H=false;var y={};var I=0;var G=0;var B=("ontouchstart" in window);var A={};A.selectstart=D;A.dragstart=D;A["touchmove mousemove"]=x;A["touchend mouseup"]=C;function D(J){if(J.stopPropagation){J.stopPropagation()}if(J.preventDefault){J.preventDefault()}J.returnValue=false}function x(N){if(H){if(h&&F.documentMode<9&&!N.button){return C()}var L=N.originalEvent&&N.originalEvent.touches&&N.originalEvent.touches[0];var K=L&&L.pageX||N.pageX;var J=L&&L.pageY||N.pageY;var O=Math.max(0,Math.min(K-y.left,G));var M=Math.max(0,Math.min(J-y.top,I));if(B){D(N)}E.apply(z,[O,M,N])}}function u(K){var J=(K.which)?(K.which==3):(K.button==2);if(!J&&!H){if(v.apply(z,arguments)!==false){H=true;I=e(z).height();G=e(z).width();y=e(z).offset();e(F).bind(A);e(F.body).addClass("sp-dragging");x(K);D(K)}}}function C(){if(H){e(F).unbind(A);e(F.body).removeClass("sp-dragging");setTimeout(function(){w.apply(z,arguments)},0)}H=false}e(z).bind("touchstart mousedown",u)}function f(v,x,u){var w;return function(){var z=this,y=arguments;var A=function(){w=null;v.apply(z,y)};if(u){clearTimeout(w)}if(u||!w){w=setTimeout(A,x)}}}function k(){return e.fn.spectrum.inputTypeColorSupport()}var i="spectrum.id";e.fn.spectrum=function(x,u){if(typeof x=="string"){var w=this;var v=Array.prototype.slice.call(arguments,1);this.each(function(){var y=d[e(this).data(i)];if(y){var z=y[x];if(!z){throw new Error("Spectrum: no such method: '"+x+"'")}if(x=="get"){w=y.get()}else{if(x=="container"){w=y.container}else{if(x=="option"){w=y.option.apply(y,v)}else{if(x=="destroy"){y.destroy();e(this).removeData(i)}else{z.apply(y,v)}}}}}});return w}return this.spectrum("destroy").each(function(){var y=e.extend({},x,e(this).data());var z=r(this,y);e(this).data(i,z.id)})};e.fn.spectrum.load=true;e.fn.spectrum.loadOpts={};e.fn.spectrum.draggable=c;e.fn.spectrum.defaults=m;e.fn.spectrum.inputTypeColorSupport=function k(){if(typeof k._cachedResult==="undefined"){var u=e("<input type='color' value='!' />")[0];k._cachedResult=u.type==="color"&&u.value!=="!"}return k._cachedResult};e.spectrum={};e.spectrum.localization={};e.spectrum.palettes={};e.fn.spectrum.processNativeColorInputs=function(){var u=e("input[type=color]");if(u.length&&!k()){u.spectrum({preferredFormat:"hex6"})}};(function(){var Y=/^[\s,#]+/,K=/\s+$/,ad=0,P=Math,T=P.round,ak=P.min,M=P.max,D=P.random;var af=function(an,ap){an=(an)?an:"";ap=ap||{};if(an instanceof af){return an}if(!(this instanceof af)){return new af(an,ap)}var ao=ac(an);this._originalInput=an,this._r=ao.r,this._g=ao.g,this._b=ao.b,this._a=ao.a,this._roundA=T(100*this._a)/100,this._format=ap.format||ao.format;this._gradientType=ap.gradientType;if(this._r<1){this._r=T(this._r)}if(this._g<1){this._g=T(this._g)}if(this._b<1){this._b=T(this._b)}this._ok=ao.ok;this._tc_id=ad++};af.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return !this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var an=this.toRgb();return(an.r*299+an.g*587+an.b*114)/1000},setAlpha:function(an){this._a=E(an);this._roundA=T(100*this._a)/100;return this},toHsv:function(){var an=B(this._r,this._g,this._b);return{h:an.h*360,s:an.s,v:an.v,a:this._a}},toHsvString:function(){var ao=B(this._r,this._g,this._b);var aq=T(ao.h*360),ap=T(ao.s*100),an=T(ao.v*100);return(this._a==1)?"hsv("+aq+", "+ap+"%, "+an+"%)":"hsva("+aq+", "+ap+"%, "+an+"%, "+this._roundA+")"},toHsl:function(){var an=G(this._r,this._g,this._b);return{h:an.h*360,s:an.s,l:an.l,a:this._a}},toHslString:function(){var ao=G(this._r,this._g,this._b);var aq=T(ao.h*360),ap=T(ao.s*100),an=T(ao.l*100);return(this._a==1)?"hsl("+aq+", "+ap+"%, "+an+"%)":"hsla("+aq+", "+ap+"%, "+an+"%, "+this._roundA+")"},toHex:function(an){return ab(this._r,this._g,this._b,an)},toHexString:function(an){return"#"+this.toHex(an)},toHex8:function(){return al(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:T(this._r),g:T(this._g),b:T(this._b),a:this._a}},toRgbString:function(){return(this._a==1)?"rgb("+T(this._r)+", "+T(this._g)+", "+T(this._b)+")":"rgba("+T(this._r)+", "+T(this._g)+", "+T(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:T(ag(this._r,255)*100)+"%",g:T(ag(this._g,255)*100)+"%",b:T(ag(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return(this._a==1)?"rgb("+T(ag(this._r,255)*100)+"%, "+T(ag(this._g,255)*100)+"%, "+T(ag(this._b,255)*100)+"%)":"rgba("+T(ag(this._r,255)*100)+"%, "+T(ag(this._g,255)*100)+"%, "+T(ag(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){if(this._a===0){return"transparent"}if(this._a<1){return false}return am[ab(this._r,this._g,this._b,true)]||false},toFilter:function(aq){var ar="#"+al(this._r,this._g,this._b,this._a);var ao=ar;var an=this._gradientType?"GradientType = 1, ":"";if(aq){var ap=af(aq);ao=ap.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+an+"startColorstr="+ar+",endColorstr="+ao+")"},toString:function(aq){var an=!!aq;aq=aq||this._format;var ap=false;var ao=this._a<1&&this._a>=0;var ar=!an&&ao&&(aq==="hex"||aq==="hex6"||aq==="hex3"||aq==="name");if(ar){if(aq==="name"&&this._a===0){return this.toName()}return this.toRgbString()}if(aq==="rgb"){ap=this.toRgbString()}if(aq==="prgb"){ap=this.toPercentageRgbString()}if(aq==="hex"||aq==="hex6"){ap=this.toHexString()}if(aq==="hex3"){ap=this.toHexString(true)}if(aq==="hex8"){ap=this.toHex8String()}if(aq==="name"){ap=this.toName()}if(aq==="hsl"){ap=this.toHslString()}if(aq==="hsv"){ap=this.toHsvString()}return ap||this.toHexString()},_applyModification:function(ap,ao){var an=ap.apply(null,[this].concat([].slice.call(ao)));this._r=an._r;this._g=an._g;this._b=an._b;this.setAlpha(an._a);return this},lighten:function(){return this._applyModification(J,arguments)},brighten:function(){return this._applyModification(v,arguments)},darken:function(){return this._applyModification(I,arguments)},desaturate:function(){return this._applyModification(O,arguments)},saturate:function(){return this._applyModification(Z,arguments)},greyscale:function(){return this._applyModification(y,arguments)},spin:function(){return this._applyModification(ae,arguments)},_applyCombination:function(ao,an){return ao.apply(null,[this].concat([].slice.call(an)))},analogous:function(){return this._applyCombination(R,arguments)},complement:function(){return this._applyCombination(W,arguments)},monochromatic:function(){return this._applyCombination(L,arguments)},splitcomplement:function(){return this._applyCombination(U,arguments)},triad:function(){return this._applyCombination(z,arguments)},tetrad:function(){return this._applyCombination(aj,arguments)}};af.fromRatio=function(an,aq){if(typeof an=="object"){var ao={};for(var ap in an){if(an.hasOwnProperty(ap)){if(ap==="a"){ao[ap]=an[ap]}else{ao[ap]=H(an[ap])}}}an=ao}return af(an,aq)};function ac(ao){var ap={r:0,g:0,b:0};var an=1;var aq=false;var ar=false;if(typeof ao=="string"){ao=N(ao)}if(typeof ao=="object"){if(ao.hasOwnProperty("r")&&ao.hasOwnProperty("g")&&ao.hasOwnProperty("b")){ap=A(ao.r,ao.g,ao.b);aq=true;ar=String(ao.r).substr(-1)==="%"?"prgb":"rgb"}else{if(ao.hasOwnProperty("h")&&ao.hasOwnProperty("s")&&ao.hasOwnProperty("v")){ao.s=H(ao.s);ao.v=H(ao.v);ap=aa(ao.h,ao.s,ao.v);aq=true;ar="hsv"}else{if(ao.hasOwnProperty("h")&&ao.hasOwnProperty("s")&&ao.hasOwnProperty("l")){ao.s=H(ao.s);ao.l=H(ao.l);ap=S(ao.h,ao.s,ao.l);aq=true;ar="hsl"}}}if(ao.hasOwnProperty("a")){an=ao.a}}an=E(an);return{ok:aq,format:ao.format||ar,r:ak(255,M(ap.r,0)),g:ak(255,M(ap.g,0)),b:ak(255,M(ap.b,0)),a:an}}function A(ap,ao,an){return{r:ag(ap,255)*255,g:ag(ao,255)*255,b:ag(an,255)*255}}function G(an,ar,au){an=ag(an,255);ar=ag(ar,255);au=ag(au,255);var av=M(an,ar,au),ap=ak(an,ar,au);var aq,aw,ao=(av+ap)/2;if(av==ap){aq=aw=0}else{var at=av-ap;aw=ao>0.5?at/(2-av-ap):at/(av+ap);switch(av){case an:aq=(ar-au)/at+(ar<au?6:0);break;case ar:aq=(au-an)/at+2;break;case au:aq=(an-ar)/at+4;break}aq/=6}return{h:aq,s:aw,l:ao}}function S(at,aw,ar){var an,au,av;at=ag(at,360);aw=ag(aw,100);ar=ag(ar,100);function aq(az,ay,ax){if(ax<0){ax+=1}if(ax>1){ax-=1}if(ax<1/6){return az+(ay-az)*6*ax}if(ax<1/2){return ay}if(ax<2/3){return az+(ay-az)*(2/3-ax)*6}return az}if(aw===0){an=au=av=ar}else{var ao=ar<0.5?ar*(1+aw):ar+aw-ar*aw;var ap=2*ar-ao;an=aq(ap,ao,at+1/3);au=aq(ap,ao,at);av=aq(ap,ao,at-1/3)}return{r:an*255,g:au*255,b:av*255}}function B(an,aq,at){an=ag(an,255);aq=ag(aq,255);at=ag(at,255);var au=M(an,aq,at),ao=ak(an,aq,at);var ap,aw,av=au;var ar=au-ao;aw=au===0?0:ar/au;if(au==ao){ap=0}else{switch(au){case an:ap=(aq-at)/ar+(aq<at?6:0);break;case aq:ap=(at-an)/ar+2;break;case at:ap=(an-aq)/ar+4;break}ap/=6}return{h:ap,s:aw,v:av}}function aa(ar,az,ax){ar=ag(ar,360)*6;az=ag(az,100);ax=ag(ax,100);var aq=P.floor(ar),au=ar-aq,ap=ax*(1-az),ao=ax*(1-au*az),ay=ax*(1-(1-au)*az),aw=aq%6,an=[ax,ao,ap,ap,ay,ax][aw],at=[ay,ax,ax,ao,ap,ap][aw],av=[ap,ap,ay,ax,ax,ao][aw];return{r:an*255,g:at*255,b:av*255}}function ab(aq,ap,an,ar){var ao=[Q(T(aq).toString(16)),Q(T(ap).toString(16)),Q(T(an).toString(16))];if(ar&&ao[0].charAt(0)==ao[0].charAt(1)&&ao[1].charAt(0)==ao[1].charAt(1)&&ao[2].charAt(0)==ao[2].charAt(1)){return ao[0].charAt(0)+ao[1].charAt(0)+ao[2].charAt(0)}return ao.join("")}function al(ar,aq,an,ao){var ap=[Q(V(ao)),Q(T(ar).toString(16)),Q(T(aq).toString(16)),Q(T(an).toString(16))];return ap.join("")}af.equals=function(ao,an){if(!ao||!an){return false}return af(ao).toRgbString()==af(an).toRgbString()};af.random=function(){return af.fromRatio({r:D(),g:D(),b:D()})};function O(ao,ap){ap=(ap===0)?0:(ap||10);var an=af(ao).toHsl();an.s-=ap/100;an.s=u(an.s);return af(an)}function Z(ao,ap){ap=(ap===0)?0:(ap||10);var an=af(ao).toHsl();an.s+=ap/100;an.s=u(an.s);return af(an)}function y(an){return af(an).desaturate(100)}function J(ao,ap){ap=(ap===0)?0:(ap||10);var an=af(ao).toHsl();an.l+=ap/100;an.l=u(an.l);return af(an)}function v(an,ap){ap=(ap===0)?0:(ap||10);var ao=af(an).toRgb();ao.r=M(0,ak(255,ao.r-T(255*-(ap/100))));ao.g=M(0,ak(255,ao.g-T(255*-(ap/100))));ao.b=M(0,ak(255,ao.b-T(255*-(ap/100))));return af(ao)}function I(ao,ap){ap=(ap===0)?0:(ap||10);var an=af(ao).toHsl();an.l-=ap/100;an.l=u(an.l);return af(an)}function ae(ap,aq){var ao=af(ap).toHsl();var an=(T(ao.h)+aq)%360;ao.h=an<0?360+an:an;return af(ao)}function W(ao){var an=af(ao).toHsl();an.h=(an.h+180)%360;return af(an)}function z(ao){var an=af(ao).toHsl();var ap=an.h;return[af(ao),af({h:(ap+120)%360,s:an.s,l:an.l}),af({h:(ap+240)%360,s:an.s,l:an.l})]}function aj(ao){var an=af(ao).toHsl();var ap=an.h;return[af(ao),af({h:(ap+90)%360,s:an.s,l:an.l}),af({h:(ap+180)%360,s:an.s,l:an.l}),af({h:(ap+270)%360,s:an.s,l:an.l})]}function U(ao){var an=af(ao).toHsl();var ap=an.h;return[af(ao),af({h:(ap+72)%360,s:an.s,l:an.l}),af({h:(ap+216)%360,s:an.s,l:an.l})]}function R(ao,ar,at){ar=ar||6;at=at||30;var an=af(ao).toHsl();var aq=360/at;var ap=[af(ao)];for(an.h=((an.h-(aq*ar>>1))+720)%360;--ar;){an.h=(an.h+aq)%360;ap.push(af(an))}return ap}function L(ap,at){at=at||6;var ar=af(ap).toHsv();var av=ar.h,au=ar.s,ao=ar.v;var aq=[];var an=1/at;while(at--){aq.push(af({h:av,s:au,v:ao}));ao=(ao+an)%1}return aq}af.mix=function(ay,ax,au){au=(au===0)?0:(au||50);var ar=af(ay).toRgb();var ap=af(ax).toRgb();var an=au/100;var aw=an*2-1;var av=ap.a-ar.a;var at;if(aw*av==-1){at=aw}else{at=(aw+av)/(1+aw*av)}at=(at+1)/2;var aq=1-at;var ao={r:ap.r*at+ar.r*aq,g:ap.g*at+ar.g*aq,b:ap.b*at+ar.b*aq,a:ap.a*an+ar.a*(1-an)};return af(ao)};af.readability=function(aw,av){var ar=af(aw);var ap=af(av);var aq=ar.toRgb();var ao=ap.toRgb();var at=ar.getBrightness();var an=ap.getBrightness();var au=(Math.max(aq.r,ao.r)-Math.min(aq.r,ao.r)+Math.max(aq.g,ao.g)-Math.min(aq.g,ao.g)+Math.max(aq.b,ao.b)-Math.min(aq.b,ao.b));return{brightness:Math.abs(at-an),color:au}};af.isReadable=function(ao,an){var ap=af.readability(ao,an);return ap.brightness>125&&ap.color>500};af.mostReadable=function(av,au){var aq=null;var ao=0;var aw=false;for(var at=0;at<au.length;at++){var ap=af.readability(av,au[at]);var ar=ap.brightness>125&&ap.color>500;var an=3*(ap.brightness/125)+(ap.color/500);if((ar&&!aw)||(ar&&aw&&an>ao)||((!ar)&&(!aw)&&an>ao)){aw=ar;ao=an;aq=af(au[at])}}return aq};var ah=af.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var am=af.hexNames=ai(ah);function ai(ap){var ao={};for(var an in ap){if(ap.hasOwnProperty(an)){ao[ap[an]]=an}}return ao}function E(an){an=parseFloat(an);if(isNaN(an)||an<0||an>1){an=1}return an}function ag(ap,an){if(X(ap)){ap="100%"}var ao=F(ap);ap=ak(an,M(0,parseFloat(ap)));if(ao){ap=parseInt(ap*an,10)/100}if((P.abs(ap-an)<0.000001)){return 1}return(ap%an)/parseFloat(an)}function u(an){return ak(1,M(0,an))}function w(an){return parseInt(an,16)}function X(an){return typeof an=="string"&&an.indexOf(".")!=-1&&parseFloat(an)===1}function F(an){return typeof an==="string"&&an.indexOf("%")!=-1}function Q(an){return an.length==1?"0"+an:""+an}function H(an){if(an<=1){an=(an*100)+"%"}return an}function V(an){return Math.round(parseFloat(an)*255).toString(16)}function C(an){return(w(an)/255)}var x=(function(){var ar="[-\\+]?\\d+%?";var aq="[-\\+]?\\d*\\.\\d+%?";var an="(?:"+aq+")|(?:"+ar+")";var ap="[\\s|\\(]+("+an+")[,|\\s]+("+an+")[,|\\s]+("+an+")\\s*\\)?";var ao="[\\s|\\(]+("+an+")[,|\\s]+("+an+")[,|\\s]+("+an+")[,|\\s]+("+an+")\\s*\\)?";return{rgb:new RegExp("rgb"+ap),rgba:new RegExp("rgba"+ao),hsl:new RegExp("hsl"+ap),hsla:new RegExp("hsla"+ao),hsv:new RegExp("hsv"+ap),hsva:new RegExp("hsva"+ao),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}})();function N(ao){ao=ao.replace(Y,"").replace(K,"").toLowerCase();var an=false;if(ah[ao]){ao=ah[ao];an=true}else{if(ao=="transparent"){return{r:0,g:0,b:0,a:0,format:"name"}}}var ap;if((ap=x.rgb.exec(ao))){return{r:ap[1],g:ap[2],b:ap[3]}}if((ap=x.rgba.exec(ao))){return{r:ap[1],g:ap[2],b:ap[3],a:ap[4]}}if((ap=x.hsl.exec(ao))){return{h:ap[1],s:ap[2],l:ap[3]}}if((ap=x.hsla.exec(ao))){return{h:ap[1],s:ap[2],l:ap[3],a:ap[4]}}if((ap=x.hsv.exec(ao))){return{h:ap[1],s:ap[2],v:ap[3]}}if((ap=x.hsva.exec(ao))){return{h:ap[1],s:ap[2],v:ap[3],a:ap[4]}}if((ap=x.hex8.exec(ao))){return{a:C(ap[1]),r:w(ap[2]),g:w(ap[3]),b:w(ap[4]),format:an?"name":"hex8"}}if((ap=x.hex6.exec(ao))){return{r:w(ap[1]),g:w(ap[2]),b:w(ap[3]),format:an?"name":"hex"}}if((ap=x.hex3.exec(ao))){return{r:w(ap[1]+""+ap[1]),g:w(ap[2]+""+ap[2]),b:w(ap[3]+""+ap[3]),format:an?"name":"hex"}}return false}window.tinycolor=af})();e(function(){if(e.fn.spectrum.load){e.fn.spectrum.processNativeColorInputs()}})});
		</script>
		<script src="js/angular-spectrum-colorpicker.min.js"></script>
		<script src="js/textAngular-dropdownToggle.js"></script>
    <script src='js/textAngular-rangy.min.js'></script>
		<script src='js/img-mapper.js'></script>
    <script>
    !function(a,b){b["true"]=a,/**
 * @license AngularJS v1.3.10
 * (c) 2010-2014 Google, Inc. http://angularjs.org
 * License: MIT
 */
function(a,b,c){"use strict";function d(){this.$get=["$$sanitizeUri",function(a){return function(b){"undefined"!=typeof arguments[1]&&(arguments[1].version="taSanitize");var c=[];return g(b,l(c,function(b,c){return!/^unsafe/.test(a(b,c))})),c.join("")}}]}function e(a){var c=[],d=l(c,b.noop);return d.chars(a),c.join("")}function f(a){var b,c={},d=a.split(",");for(b=0;b<d.length;b++)c[d[b]]=!0;return c}function g(a,c){function d(a,d,f,g){if(d=b.lowercase(d),D[d])for(;k.last()&&E[k.last()];)e("",k.last());C[d]&&k.last()==d&&e("",d),g=z[d]||!!g,g||k.push(d);var i={};f.replace(p,function(a,b,c,d,e){var f=c||d||e||"";i[b]=h(f)}),c.start&&c.start(d,i,g)}function e(a,d){var e,f=0;if(d=b.lowercase(d))for(f=k.length-1;f>=0&&k[f]!=d;f--);if(f>=0){for(e=k.length-1;e>=f;e--)c.end&&c.end(k[e]);k.length=f}}"string"!=typeof a&&(a=null===a||"undefined"==typeof a?"":""+a);var f,g,i,j,k=[],l=a;for(k.last=function(){return k[k.length-1]};a;){if(j="",g=!0,k.last()&&G[k.last()])a=a.replace(new RegExp("([^]*)<\\s*\\/\\s*"+k.last()+"[^>]*>","i"),function(a,b){return b=b.replace(s,"$1").replace(v,"$1"),c.chars&&c.chars(h(b)),""}),e("",k.last());else{if(y.test(a)){if(i=a.match(y)){i[0];c.whitespace&&c.whitespace(i[0]),a=a.replace(i[0],""),g=!1}}else t.test(a)?(i=a.match(t),i&&(c.comment&&c.comment(i[1]),a=a.replace(i[0],""),g=!1)):u.test(a)?(i=a.match(u),i&&(a=a.replace(i[0],""),g=!1)):r.test(a)?(i=a.match(o),i&&(a=a.substring(i[0].length),i[0].replace(o,e),g=!1)):q.test(a)&&(i=a.match(n),i?(i[4]&&(a=a.substring(i[0].length),i[0].replace(n,d)),g=!1):(j+="<",a=a.substring(1)));g&&(f=a.indexOf("<"),j+=0>f?a:a.substring(0,f),a=0>f?"":a.substring(f),c.chars&&c.chars(h(j)))}if(a==l)throw m("badparse","The sanitizer was unable to parse the following block of html: {0}",a);l=a}e()}function h(a){if(!a)return"";var b=N.exec(a),c=b[1],d=b[3],e=b[2];return e&&(M.innerHTML=e.replace(/</g,"&lt;"),e="textContent"in M?M.textContent:M.innerText),c+e+d}function i(a){return a.replace(/&/g,"&amp;").replace(w,function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1);return"&#"+(1024*(b-55296)+(c-56320)+65536)+";"}).replace(x,function(a){var b=a.charCodeAt(0);return 159>=b||173==b||b>=1536&&1540>=b||1807==b||6068==b||6069==b||b>=8204&&8207>=b||b>=8232&&8239>=b||b>=8288&&8303>=b||65279==b||b>=65520&&65535>=b?"&#"+b+";":a}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function j(a){var c="",d=a.split(";");return b.forEach(d,function(a){var d=a.split(":");if(2==d.length){var e=O(b.lowercase(d[0])),a=O(b.lowercase(d[1]));(("color"===e||"background-color"===e)&&(a.match(/^rgb\([0-9%,\. ]*\)$/i)||a.match(/^rgba\([0-9%,\. ]*\)$/i)||a.match(/^hsl\([0-9%,\. ]*\)$/i)||a.match(/^hsla\([0-9%,\. ]*\)$/i)||a.match(/^#[0-9a-f]{3,6}$/i)||a.match(/^[a-z]*$/i))||"text-align"===e&&("left"===a||"right"===a||"center"===a||"justify"===a)||"float"===e&&("left"===a||"right"===a||"none"===a)||("width"===e||"height"===e)&&a.match(/[0-9\.]*(px|em|rem|%)/)||"direction"===e&&a.match(/^ltr|rtl|initial|inherit$/))&&(c+=e+": "+a+";")}}),c}function k(a,b,c,d){return"img"===a&&b["ta-insert-video"]&&("ta-insert-video"===c||"allowfullscreen"===c||"frameborder"===c||"contenteditable"===c&&"false"===d)?!0:!1}function l(a,c){var d=!1,e=b.bind(a,a.push);return{start:function(a,f,g){a=b.lowercase(a),!d&&G[a]&&(d=a),d||H[a]!==!0||(e("<"),e(a),b.forEach(f,function(d,g){var h=b.lowercase(g),l="img"===a&&"src"===h||"background"===h;("style"===h&&""!==(d=j(d))||k(a,f,h,d)||L[h]===!0&&(I[h]!==!0||c(d,l)))&&(e(" "),e(g),e('="'),e(i(d)),e('"'))}),e(g?"/>":">"))},comment:function(a){e(a)},whitespace:function(a){e(i(a))},end:function(a){a=b.lowercase(a),d||H[a]!==!0||(e("</"),e(a),e(">")),a==d&&(d=!1)},chars:function(a){d||e(i(a))}}}var m=b.$$minErr("$sanitize"),n=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,o=/^<\/\s*([\w:-]+)[^>]*>/,p=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,q=/^</,r=/^<\//,s=/<!--(.*?)-->/g,t=/(^<!--.*?-->)/,u=/<!DOCTYPE([^>]*?)>/i,v=/<!\[CDATA\[(.*?)]]>/g,w=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,x=/([^\#-~| |!])/g,y=/^(\s+)/,z=f("area,br,col,hr,img,wbr,input"),A=f("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),B=f("rp,rt"),C=b.extend({},B,A),D=b.extend({},A,f("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),E=b.extend({},B,f("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),F=f("animate,animateColor,animateMotion,animateTransform,circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,set,stop,svg,switch,text,title,tspan,use"),G=f("script,style"),H=b.extend({},z,D,E,C,F),I=f("background,cite,href,longdesc,src,usemap,xlink:href"),J=f("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,id,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width"),K=f("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,attributeName,attributeType,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan"),L=b.extend({},I,K,J),M=document.createElement("pre"),N=/^(\s*)([\s\S]*?)(\s*)$/,O=function(){return String.prototype.trim?function(a){return b.isString(a)?a.trim():a}:function(a){return b.isString(a)?a.replace(/^\s\s*/,"").replace(/\s\s*$/,""):a}}();b.module("ngSanitize",[]).provider("$sanitize",d),b.module("ngSanitize").filter("linky",["$sanitize",function(a){var c=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"”’]/,d=/^mailto:/;return function(f,g){function h(a){a&&n.push(e(a))}function i(a,c){n.push("<a "),b.isDefined(g)&&n.push('target="',g,'" '),n.push('href="',a.replace(/"/g,"&quot;"),'">'),h(c),n.push("</a>")}if(!f)return f;for(var j,k,l,m=f,n=[];j=m.match(c);)k=j[0],j[2]||j[4]||(k=(j[3]?"http://":"mailto:")+k),l=j.index,h(m.substr(0,l)),i(k,j[0].replace(d,"")),m=m.substring(l+j[0].length);return h(m),a(n.join(""))}}])}(window,window.angular)}({},function(){return this}());
    </script>
    <script src="js/textAngularSetup.js"></script>
		<script src='js/textAngular.js'></script>
		<script>
      var JSConfigApp = angular.module('JSConfigApp', ['textAngular']).controller('JSConfigAppCtrl', ['$scope', '$sce', function ($scope, $sce) {

        //globals
        var cellOuterWidth;
        var fullSliderContainerWidth;
        $scope.pageNumber = 0;
        $scope.setPageNumber = function(index) {
          $scope.pageNumber = index;
        }

        // this object has all the parameters for our drawer
        $scope.promos = {
          global : {
            launchDate : "",
            headerText : "",
            subHeaderText : "",
            promos : [{
              bannerContent : {
                imgOrHTML : "img",
                img : {
                  contentParameters: {
                    link : false,
                    linkUrl : "",
                    imageMap : "",
                    useMap : false
                  },
                  images : {
                    path: "",
                    dataUri: ""
                  }
                },
                HTML : {
                  useLocal: false,
                  localHTML: '<h1 style="text-align: center;">Headline</h1>\
    <h4 style="text-align: center;">Subheader</h4>\
    <p style="text-align: center;">Some optional info</p>\
    <p style="text-align: center;">\
    <a href="/category.html" target="">Link 1</a>&nbsp;\
    <a href="/cat.html">Link 2</a>\
    </p>',
                  backgroundColor : "#FFFFFF",
                  path : ""
                }
              },
              tapContent : {
                displayType : "generic",
                legalOverride : "",
                genericCodeId : "",
                genericCode : ""
              }
            }]
          }
        }

        $scope.delete = function ( idx ) {
          $scope.promos.global.promos.splice(idx, 1);
          fullSliderContainerWidth = cellOuterWidth * $scope.promos.global.promos.length;
          jQuery(".offerspotlight-drawer-slider-items").css('width', fullSliderContainerWidth+"px");
        };

        $scope.moveCell = function ( old_index, dir ) {
          var new_index = old_index + dir;
          if (new_index >= $scope.promos.global.promos.length) {
            var k = new_index - $scope.promos.global.promos.length;
            while ((k--) + 1) {
                $scope.promos.global.promos.push(undefined);
            }
          }
          $scope.promos.global.promos.splice(new_index, 0, $scope.promos.global.promos.splice(old_index, 1)[0]);
          //return this; // for testing purposes
        };


        $scope.addItem = function () {
          $scope.promos.global.promos.push({
            bannerContent : {
              imgOrHTML : "img",
              img : {
                contentParameters: {
                  link : false,
                  linkUrl : "",
                  imageMap : "",
                  useMap : false
                },
                images : {
                  path: "",
                  dataUri: ""
                }
              },
              HTML : {
                useLocal: false,
                localHTML: '<h1 style="text-align: center;">Headline</h1>\
      <h4 style="text-align: center;">Subheader</h4>\
      <p style="text-align: center;">Some optional info</p>\
      <p style="text-align: center;">\
      <a href="/category.html">Link 1</a>&nbsp;\
      <a href="/cat.html">Link 2</a>\
      </p>',
                backgroundColor : "#FFFFFF",
                path : ""
              }
            },
            tapContent : {
              displayType : "generic",
              legalOverride : "",
              genericCodeId : "",
              genericCode : ""
            }
          });
          cellOuterWidth = jQuery(".offerspotlight-drawer-slider-item").outerWidth(true);
          fullSliderContainerWidth = cellOuterWidth * $scope.promos.global.promos.length;
          jQuery(".offerspotlight-drawer-slider-items").css('width', fullSliderContainerWidth+"px");
        };

        // experimental function for pulling in PPC iframe to ensure accurate code is chosen
        $scope.cleanUrl = function(index) {
           return $sce.trustAsResourceUrl("https://secure.www.brol.wip.gidapps.com/buy/promo_legal_details.do?promoId=" + $scope.promos.global.promos[index].tapContent.genericCodeId);
        }


        // This section deals with importing a json file and then building out our global
        // configuration and updating the view.

        jQuery("#the-file-input").change(function() {
          $scope.renderJSON(this.files[0]);
        });

        $scope.renderJSON = function(file) {
          var fr = new FileReader();
          fr.onload = function(e) {
          var newArr = JSON.parse(e.target.result);
          $scope.$apply( $scope.promos = newArr );
          cellOuterWidth = jQuery(".offerspotlight-drawer-slider-item").outerWidth(true);
          fullSliderContainerWidth = cellOuterWidth * $scope.promos.global.promos.length;
          jQuery(".offerspotlight-drawer-slider-items").css('width', fullSliderContainerWidth+"px");
          jQuery('.redeem').on( 'click', function() {
              jQuery( this ).toggleClass( 'applied' );
              jQuery(this).toggleText('Applied At Bag' , 'Redeem Now')
              return false;
          });
          }
          fr.readAsText(file);
        }

        // JSON export function
        $scope.myEncodeJson = function(obj){
          newObj = this.stripClone(obj);
          return JSON.stringify(newObj);
        };

        $scope.stripClone = function(obj) {
          if (null == obj || "object" != typeof obj) return obj;
          var copy = obj.constructor();
          for (var attr in obj) {
          if (obj.hasOwnProperty(attr) && attr != '$$hashKey') {
            var obj_attr = obj[attr];
            if (typeof obj_attr == "object"){
            copy[attr] = this.stripClone(obj_attr);
            } else if (typeof obj_attr == "array"){
            copy[attr] =[];
            for(var i =0; i<obj_attr.length; i++){
              copy[attr].push(this.stripClone(obj_attr));
            }
            }else{
            copy[attr] = obj_attr;
            }
          }
          }
          return copy;
        };




        // load up an image and convert it to a dataURI
        jQuery(document).on('change','#the-img-input' , function(){
          $scope.renderURI(this, function( dataUri ) {
            $scope.$apply( $scope.promos.global.promos[$scope.pageNumber].bannerContent.img.images.dataUri = dataUri);
          });
        });

        $scope.renderURI = function (input, callback) {
          var image = new Image();
          image.onload = function () {
            var canvas = document.createElement('canvas');
            canvas.width = this.naturalWidth; // or 'width' if you want a special/scaled size
            canvas.height = this.naturalHeight; // or 'height' if you want a special/scaled size
            canvas.getContext('2d').drawImage(this, 0, 0);
            $scope.imgError = "";
            if ( canvas.width != 331 && canvas.height != 183 ) {
              $scope.imgError = 'Your image is '+canvas.width+' pixels wide by '+canvas.height+' pixels high. Recommended dimensions are 331 pixels wide by 183 pixels high. Your image may be distorted.';
            }

            callback(canvas.toDataURL('image/jpeg').replace(/^data:image\/(png|jpg);base64,/, ''));

          };

          if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
              image.src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
          }
        }

        $scope.erasePic = function(index) {
           $scope.promos.global.promos[index].bannerContent.img.images.dataUri = "";
        }




        // handle the changing of the background in editor and preview
        $scope.bgColorChange = function(index) {
          jQuery('.ta-text:eq("'+index+'"), .html-preview:eq("'+index+'")').css('background-color',$scope.promos.global.promos[index].bannerContent.HTML.backgroundColor);
        }

        // attach event to tap to apply button
        $scope.attachRedeem = function () {
          jQuery('.redeem').on( 'click', function() {
              jQuery( this ).toggleClass( 'applied' );
              jQuery(this).toggleText('Applied At Bag' , 'TAP TO APPLY')
              return false;
          });
        }
      }]);

      JSConfigApp.config(['$compileProvider', function ($compileProvider) {
        $compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|data|blob):/);
      }]);

      jQuery.fn.toggleText = function(t1, t2){
        if (this.text() == t1) this.text(t2);
        else                   this.text(t1);
        return this;
      };
		</script>
	</body>
</html>
